<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Fixing Chef version in Ubuntu precise64 box for Vagrant 2.0</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">/dev/null</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Fixing Chef version in Ubuntu precise64 box for Vagrant 2.0</h2>
<p class="meta">15 Nov 2013</p>

<div class="post">
<p>I upgraded <a href="http://www.vagrantup.com/">Vagrant</a> on my workstation to version 2.0 a couple of weeks ago. Whenever I ran a project now, that I have worked on using Vagrant in the past, I was prompted with this message:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">There were warnings and/or errors while loading your Vagrantfile
for the machine &#39;default&#39;.

Your Vagrantfile was written for an earlier version of Vagrant,
and while Vagrant does the best it can to remain backwards
compatible, there are some cases where things have changed
significantly enough to warrant a message. These messages are
shown below.

Warnings:
* `config.vm.customize` calls are VirtualBox-specific. If you&#39;re
using any other provider, you&#39;ll have to use config.vm.provider in a
v2 configuration block.
</code></pre></div>
<p>The message was telling that the <code>Vagrantfile</code> configuration file should be updated to a new schema, but for the time being the new version of Vagrant would be <a href="http://docs.vagrantup.com/v2/installation/backwards-compatibility.html">backwards compatible</a> with that configuration.</p>

<p>Actually this turned out to be true. At least for some days. I use Chef to provision my development environment virtual machine in Vagrant. When running <code>vagrant up</code> on some of my projects now, cookbooks did not compile anymore. I thought this was an issue with a Ruby version that is installed wo the virtual machine. So it took some time of investigation and it turned out that actually Vagrant does not keep track on the upstream of Chef. The virtual machine did not run any recent version of Chef, but cookbooks keep track of the recent development and adopted new Chef schemas, at least the common ones.</p>

<p>In all the projects I work on that are powered by a Vagrant environment I use the Ubuntu precise 64 bit AMD Vagrant box (You can find out more about Vagrant boxes <a href="www.vagrantbox.es">here</a>). That box I get from <code>http://files.vagrantup.com/precise64.box</code> and right now it boils down to <code>Ubuntu 12.04 LTS (GNU/Linux 3.2.0-23-generic x86_64)</code>. That box currently runs Chef version 10.14.2. Actually the latest version of Chef, which I would expect the cookbooks to refer to, is 11.8.0.</p>

<p>Now there are several ways to make your box to take up with the latest version of Chef. You can include code in the Vagrantfile to do that &#39;manually&#39; via aptitude or go vor any Ubuntu-specific package management tool. However, I found a very handy way of doing that on <a href="http://stackoverflow.com/questions/11325479/how-to-control-the-version-of-chef-that-vagrant-uses-to-provision-vms/18213542#18213542">StackOverflow</a>, which solved the problem easily. I used a Vagrant plugin called omnibus. To install the plugin on the host machine I simply ran <code>vagrant plugin install vagrant-omnibus</code>. To make my project&#39;s virtual machine use the latest version of Chef I included <code>config.omnibus.chef_version = :latest</code> before the provisioning specifications in the Vagrantfile.</p>

</div>


          <div class="footer">
            <div class="contact">
              <p>
                Martin Biermann<br />
                Software Engineer
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/mbiermann">github.com/mbiermann</a><br />
                <a href="https://twitter.com/bierchn">twitter.com/bierchn</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
